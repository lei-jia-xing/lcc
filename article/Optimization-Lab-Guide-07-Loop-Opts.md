# 7. 循环优化：LoopAnalysis / LICM / LoopUnroll

循环优化的要点是：你必须先能识别循环，否则 LICM/Unroll 都是空谈。

## 7.1 LoopAnalysis

典型做法：用支配树识别回边（back-edge），收集自然循环。

## 7.2 LICM：别碰有副作用的东西

LICM 的安全条件（最保守版本）：

- 指令无副作用（不含 STORE/CALL）
- 指令的所有操作数在循环外定义，或者是常量

数组访问通常不要外提，除非你能证明地址与内容都不变。

## 7.3 LoopUnroll：从“最小可行”开始

建议先做：

- 单块自循环 + 单归纳变量 + 常量 tripcount 的完全展开

把边界情况（多块循环、多个归纳变量、复杂条件）先放一放，先把正确性打牢。
